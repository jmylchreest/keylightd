app-id: io.github.jmylchreest.keylightd
runtime: org.freedesktop.Platform
runtime-version: "23.08"
sdk: org.freedesktop.Sdk
command: keylightctl
finish-args:
  - --share=network
  - --socket=x11
  - --socket=wayland
  - --own-name=io.github.jmylchreest.keylightd
  - --filesystem=home
  - --talk-name=org.freedesktop.systemd1

modules:
  - name: keylightd
    buildsystem: simple
    build-commands:
      # Install pre-built binaries
      - install -Dm755 binaries/keylightd /app/bin/keylightd
      - install -Dm755 binaries/keylightctl /app/bin/keylightctl

      # Create default configuration directory
      - mkdir -p /app/share/keylightd

      # Install systemd user service file
      - install -Dm644 contrib/flatpak/io.github.jmylchreest.keylightd.service /app/share/systemd/user/io.github.jmylchreest.keylightd.service

      # Install desktop autostart file
      - install -Dm644 contrib/flatpak/io.github.jmylchreest.keylightd-autostart.desktop /app/share/applications/io.github.jmylchreest.keylightd-autostart.desktop

      # Install desktop entry
      - install -Dm644 contrib/flatpak/io.github.jmylchreest.keylightd.desktop /app/share/applications/io.github.jmylchreest.keylightd.desktop

      # Install icon
      - install -Dm644 contrib/gnome-extension/keylightd-control@jmylchreest.github.io/icons/hicolor/scalable/actions/light-enabled.svg /app/share/icons/hicolor/scalable/apps/io.github.jmylchreest.keylightd.svg

      # Install appstream metadata
      - install -Dm644 contrib/flatpak/io.github.jmylchreest.keylightd.metainfo.xml /app/share/metainfo/io.github.jmylchreest.keylightd.metainfo.xml
    sources:
      - type: git
        url: https://github.com/jmylchreest/keylightd.git
        tag: v1.0.0  # Will be set by tag or release when building
      - type: dir
        path: binaries  # Directory containing pre-built binaries